"use strict";(self.webpackChunkmedic_hospital_management=self.webpackChunkmedic_hospital_management||[]).push([[908],{4457:(t,e,n)=>{n.d(e,{Z:()=>s});var i=n(9301),r=n(4155),o="/api/v1";const s={findAllMedia:function(t,e){return i.Z.get(r.env.VUE_APP_BACKEND_URL+"/media/"+t+"/"+e)},downloadMedia:function(t){return i.Z.get(r.env.VUE_APP_BACKEND_URL+"/media/"+t,{responseType:"blob"})},deleteMedia:function(t){return i.Z.delete(r.env.VUE_APP_BACKEND_URL+"/media/"+t)},findAllHeaders:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/invoices",t)},findHeaderById:function(t){return i.Z.get("/invoices/"+t)},createHeader:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.create("header",t,e)},findAllDetail:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("detail",t)},findDetailById:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.find("detail",t,e)},createDetail:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.create("detail",t,e)},createAddress:function(t){return jsonApi.create("address",t)},updateAddress:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.update("address",t,e)},findAddressById:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.find("address",t,e)},updateSettings:function(t){return jsonApi.update("setting",t)},findAllSettings:function(){return jsonApi.findAll("setting")},updateSetting:function(t){return jsonApi.update("setting",t)},findSettingById:function(t){return jsonApi.find("setting",t)},findAllVisitTypes:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/visits",t)},updateOrganization:function(t){return i.Z.put("/organizations/"+t.id+"/",t)},updateInstitutionPhoto:function(t){return t.post(o+"/organization/update_logo")},findOrganization:function(){return i.Z.get("/organizations")},searchDepartments:function(t){return i.Z.get(o+"/departments?name="+t)},findAllDepartments:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/departments",t)},findDepartmentById:function(t){return i.Z.get("/departments/"+t)},createDepartment:function(t){return i.Z.post("/departments",t)},updateDepartment:function(t){return i.Z.patch("/departments/".concat(t.id),t)},findIdentification:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.find("identification",t,e||{})},createIdentification:function(t){return i.Z.post("/identifications",t)},updateIdentification:function(t){return i.Z.patch("/identifications/"+t.id,t)},deleteIdentification:function(t){return jsonApi.destroy("identification",t)},findWardById:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.Z.get("/wards/"+t,e)},findAllWards:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/wards",t)},createWard:function(t){return i.Z.post("/wards",t)},updateWard:function(t){return i.Z.patch("/wards/".concat(t.id),t)},deleteWard:function(t){return i.Z.delete(o+"/wards/"+t)},getBranches:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/branches",t)},findBranchById:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.find("branch",t,e)},createBranch:function(t){return i.Z.post("/branches",t)},updateBranch:function(t){return i.Z.patch("/branches/".concat(t.id),t)},getWards:function(t){return i.Z.get(o+"/wards?branchId="+t)},getStores:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("store",t)},searchStore:function(t){return i.Z.get(o+"/stores?name="+t)},findAllItemTypes:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/item_types",t)},createItemType:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.create("items_type",t,e)},updateItemType:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.update("items_type",t,e)},findAllItemsGroups:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/item_groups",t)},createItemGroup:function(t){return i.Z.post("/item_groups",t)},updateItemGroup:function(t){return i.Z.patch("/item_groups/"+t.id,t)},deleteItemGroup:function(t){return i.Z.delete("/item_groups/"+t)},findAllItems:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/datatable/products",t)},findItemById:function(t){return i.Z.get("/items/"+t)},findAllPricesList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/price_lists",t)},createPriceList:function(t){return i.Z.post("/prices_lists",t)},updatePriceList:function(t){return i.Z.patch("/prices_lists/"+t.id,t)},deletePriceList:function(t){return i.Z.delete("/prices_lists/"+t)},findAllItemsAssociation:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("items_association",t)},deleteItemsAssociation:function(t){return jsonApi.destroy("items_association",t)},createItemsAssociation:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.create("items_association",t,e)},findAllDailyCharges:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("daily_charge",t)},createDailyCharge:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.create("daily_charge",t,e)},updateDailyCharge:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.update("daily_charge",t,e)},deleteDailyCharge:function(t){return jsonApi.destroy("daily_charge",t)},searchUOM:function(t){return i.Z.get(o+"/unit_of_measure?filter=".concat(t))},createItem:function(t){return i.Z.post("/items",t)},updateItem:function(t){return i.Z.patch("/items/".concat(t.id),t)},deleteItem:function(t){return i.Z.delete(o+"/items/"+t)},findAllFormulations:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/formulations",t)},createFormulation:function(t){return i.Z.post("/formulations",t)},updateFormulation:function(t){return i.Z.patch("/formulations/".concat(t.id),t)},createRoute:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.create("route",t,e)},updateRoute:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.update("route",t,e)},findAllRoute:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("route",t)},createProductRoute:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.create("items_route",t,e)},deleteProductRoute:function(t){return jsonApi.destroy("items_route",t)},findAllUOM:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/uoms",t)},createUOM:function(t){return i.Z.post("/unit_of_measurements",t)},updateUOM:function(t){return i.Z.patch("/unit_of_measurements/".concat(t.id),t)},findAllItemsAssignment:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("item_assignment",t)},createItemAssignment:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.create("item_assignment",t,e)},deleteItemAssignment:function(t){return jsonApi.destroy("item_assignment",t)},updateItemAssignment:function(t){return t.put(o+"/items/"+t.item_id+"/assignments/"+t.id)},createItemAssociation:function(t){return t.post(o+"/items/"+t.item_id+"/associations")},deleteItemAssociation:function(t,e){return i.Z.delete(o+"/items/"+t+"/associations/"+e)},updateItemAssociation:function(t){return t.put(o+"/items/"+t.item_id+"/associations/"+t.id)},deleteFormulation:function(t){return i.Z.delete(o+"/formulations/"+t.id)},getUOM:function(){return i.Z.get(o+"/unit_of_measure")},deleteUOM:function(t){return i.Z.delete(o+"/unit_of_measure/"+t.id)},createReligion:function(t){return jsonApi.create("religion",{name:t.name})},updateReligion:function(t){return jsonApi.update("religion",{id:t.id,name:t.name})},deleteReligion:function(t){return jsonApi.destroy("religion",t)},findAllReligion:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("religion",t)},findStoreById:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.find("store",t,e)},findAllStore:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/stores",t)},createStore:function(t){return i.Z.post("/stores",t)},updateStore:function(t){return i.Z.patch("/stores/".concat(t.id),t)},findAllPrefixes:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("prefix",t)},findPrefixById:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.find("prefix",t,e)},createPrefix:function(t){return jsonApi.create("prefix",t,t)},updatePrefix:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.update("prefix",t,e)},getWArdBeds:function(t){return i.Z.get(o+"/beds?ward_id="+t)},findAllBeds:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("bed",t)},createBed:function(t){return i.Z.post("/beds",t)},updateBed:function(t){return i.Z.patch("/beds/".concat(t.id),t)},findBedById:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jsonApi.find("bed",t,e)},deleteBed:function(t){return i.Z.delete(o+"/beds/"+t)},searchCountries:function(t){return i.Z.get(o+"/countries?name=".concat(t))},findAllCountries:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("country",t)},findAllCurrencies:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("currency",t)},getRelationships:function(){return i.Z.get(o+"/relationships")},findAllIdentifications:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/identifications",t)},findAllGender:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/genders",t)},findAllProductType:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/item_types",t)},createProductType:function(t){return t.post(o+"/item-types")},updateProductType:function(t){return t.put(o+"/item-types/"+t.id)},deleteProductType:function(t){return i.Z.delete(o+"/item-types/"+t)},createProductGroup:function(t){return t.post(o+"/item-groups")},updateProductGroup:function(t){return t.put(o+"/item-groups/"+t.id)},deleteProductGroup:function(t){return i.Z.delete(o+"/item-groups/"+t)},findAllReligions:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/religions",t)},findReligionById:function(t){return i.Z.get("/religions/"+t)},findAllBloodGroups:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("bloodGroup",t)},findAllMaritalStatuses:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Z.get("/marital_statuses",t)},findAllRelationships:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return jsonApi.findAll("relationship",t)}}},8908:(t,e,n)=>{n.r(e),n.d(e,{default:()=>s});n(1902),n(6887);var i=n(4457),r=n(4801);n(3279);const o={props:{items:{type:Array,default:function(){return[]}},invoice:{type:Object,required:!0},patientVisit:{type:Object,required:!0}},data:function(){return{fields:[{name:"date",title:"Date",callback:this.$options.filters.date_DATE_MONTH_YEAR},{name:"description",title:"Description"},{name:"total",title:"TOTAL",callback:function(t){return t<0?"("+(0,r.p)(Math.abs(t)).toFormat("0,0.00")+")":(0,r.p)(t).toFormat("0,0.00")},titleClass:"text-end pe-3",dataClass:"text-end pe-3",width:"10%"},{name:"billed_by",title:"Requested by"},{name:"__slot:actions",dataClass:"text-right"}],bills:[],form:new window.Form({id:null,item_id:"",comments:"",ledger_id:"",date:(new Date).toISOString().slice(0,10),quantity:1,unit_price:1,items:[]}),invoices:[],productPrice:0}},computed:{vuetable:function(){return this.$refs.table.$refs.vuetable},productItems:function(){return this.retrievePatientBills(),this.items.filter((function(t){return t.department.is_laboratory}))}},watch:{"form.item_id":function(t){t&&this.findProductPriceSetup(t)}},methods:{url:function(){return"/patient-billing/patient-bills/"+this.invoice.hashid},retrievePatientBills:function(){var t=this;this.$httpClient.get("/patient-billing/patient-bills/"+this.invoice.hashid).then((function(e){var n=e.data;t.bills=n.bills.filter((function(t){return"Laboratory"===t.department_name}))})).catch((function(){t.$toast.error("There was a problem retrieving the patient bills")}))},findProductPriceSetup:function(t){var e=this.items.find((function(e){return e.id===t}));0===this.invoice.cash_credit&&(this.form.unit_price=e.cash_price?.01*e.cash_price.charge_value:0),1===this.invoice.cash_credit&&(this.form.unit_price=e.scheme_price?.01*e.scheme_price.charge_value:0)},submitTestRequest:function(){var t=this;this.form.processing=!0,this.form.ledger_id=this.invoice.id;var e=this,n=this.items.find((function(t){return t.id===e.form.item_id}));if(0!==this.invoice.cash_credit||n.cash_price)if(1!==this.invoice.cash_credit||n.scheme_price){var i={description:n.name,item_id:this.form.item_id,quantity:1,unit_price:this.form.unit_price,ledger_id:this.form.ledger_id};this.form.items.push(i),this.form.post("/patient-bills").then((function(){t.vuetable.reload(),t.retrievePatientBills(),t.$toast.success("Test has been requested"),t.cleanUp(),t.$bvModal.hide("test-modal")})).catch()}else this.$toast.error("The test billing price has not been set");else this.$toast.error("The test billing price has not been set")},deleteTest:function(t){var e=this;console.log("d"),t.paid?this.$toast.error("The test has been paid for. You cannot paid transactions"):this.$toast.question("Do you want to continue?","Deleting Test!").then((function(){e.$httpClient.post("/bills/reverse",{comments:"Deleted by doctor",detail_id:t.id,ledger_id:e.invoice.id,source:"1"}).then((function(){e.retrievePatientBills(),e.vuetable.reload(),e.$toast.success("The test has been deleted")})).catch((function(){e.$toast.error("The test could not be deleted. Please try again later")}))}))},cleanUp:function(){this.vuetable.reload(),this.form.reset()},findProcedureForVisit:function(){this.vuetable.reload()},findAllInvoices:function(){var t=this;i.Z.findAllHeaders({sort:"-date",page:{size:2e4},filter:{patient_id:this.invoice.patient_id}}).then((function(e){var n=e.data;t.invoices=n})).catch()}}};const s=(0,n(1900).Z)(o,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"card rounded-3"},[e("div",{staticClass:"card-header"},[e("h2",[t._v("Lab Test")]),t._v(" "),e("div",{staticClass:"card-actions"},[null===t.invoice.processed_at?e("button",{directives:[{name:"b-modal",rawName:"v-b-modal:test-modal",arg:"test-modal"}],staticClass:"btn btn-outline-primary"},[e("i",{staticClass:"uil uil-plus me-1"}),t._v("\n            New Test\n          ")]):t._e()])]),t._v(" "),e("vue-table",{ref:"table",attrs:{data:t.bills,"api-mode":!1,fields:t.fields},scopedSlots:t._u([{key:"actions",fn:function(n){return[null===t.invoice.processed_at?e("div",{staticClass:"dropdown"},[e("button",{staticClass:"btn dropdown-toggle align-text-top",attrs:{"data-bs-toggle":"dropdown"}},[t._v("\n              Menu\n            ")]),t._v(" "),e("div",{staticClass:"dropdown-menu dropdown-menu-end"},[e("a",{staticClass:"dropdown-item text-danger",attrs:{href:"#"},on:{click:function(e){return t.deleteTest(n.rowData)}}},[e("i",{staticClass:"uil uil-trash-alt me-2"}),t._v(" Delete\n              ")])])]):t._e()]}}])})],1),t._v(" "),e("b-modal",{attrs:{id:"test-modal",title:"Test Form","no-close-on-backdrop":"","hide-header-close":"","content-class":"rounded-3 bg-white","body-class":"px-4","modal-class":"modal-blur","footer-class":"d-flex justify-content-between border-top bg-light"},on:{hidden:t.cleanUp},scopedSlots:t._u([{key:"modal-footer",fn:function(n){var i=n.cancel;return[e("button",{staticClass:"btn btn-light me-2",attrs:{disabled:t.form.processing},on:{click:i}},[t._v("\n          Close\n        ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{form:"form",type:"submit",disabled:t.form.processing}},[t._v("\n          Request Test\n        ")])]}}])},[e("form",{attrs:{id:"form"},on:{submit:function(e){return e.preventDefault(),t.submitTestRequest.apply(null,arguments)}}},[e("div",{staticClass:"form-group mb-4"},[e("label",{staticClass:"form-label"},[t._v("Test")]),t._v(" "),e("v-select",{attrs:{options:t.productItems,label:"name",clearable:!1,reduce:function(t){return t.id}},scopedSlots:t._u([{key:"selected-option",fn:function(n){return[e("div",[e("div",{staticClass:"font-weight-medium"},[t._v("\n                  "+t._s(n.name)+"\n                ")]),t._v(" "),0===t.invoice.cash_credit?e("div",{staticClass:"text-primary small"},[t._v("\n                  KES "+t._s(t._f("toMoneyFormat")(n.cash_price?.01*n.cash_price.charge_value:0))+"\n                ")]):e("div",{staticClass:"text-primary small"},[t._v("\n                  KES "+t._s(t._f("toMoneyFormat")(n.scheme_price?.01*n.scheme_price.charge_value:0))+"\n                ")])])]}}]),model:{value:t.form.item_id,callback:function(e){t.$set(t.form,"item_id",e)},expression:"form.item_id"}}),t._v(" "),t.form.hasError("item_id")?e("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.getError("item_id"))}}):t._e()],1),t._v(" "),e("div",{staticClass:"mb-3"},[e("label",{staticClass:"form-label",attrs:{for:""}},[t._v("Comments "),e("small",[t._v("(optional)")])]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.comments,expression:"form.comments"}],staticClass:"form-control",attrs:{id:"note",type:"text",name:"comments"},domProps:{value:t.form.comments},on:{input:function(e){e.target.composing||t.$set(t.form,"comments",e.target.value)}}}),t._v(" "),t.form.errors.has("comments")?e("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.errors.get("comments"))}}):t._e()])])])],1)}),[],!1,null,null,null).exports}}]);