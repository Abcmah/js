"use strict";(self.webpackChunkmedic_hospital_management=self.webpackChunkmedic_hospital_management||[]).push([[833],{4833:(t,i,s)=>{s.r(i),s.d(i,{default:()=>n});const e={props:["patientVisit","invoice","prescriptions","stores","items"],data:function(){return{prescriptionsField:[{key:"prescription_date",label:"DATE",formatter:this.$options.filters.date_DATE_MONTH_YEAR},{key:"item_name",label:"DRUG"},{key:"prescription_dosage",label:"DOSAGE",tdClass:"text-center",thClass:"text-center"},{key:"prescription_frequency",label:"FREQUENCY",tdClass:"text-center",thClass:"text-center"},{key:"prescription_duration",label:"DURATION (DAYS)",tdClass:"text-center",thClass:"text-center"},{key:"action",label:"",tdClass:"text-center"}],selectedPrescription:null,dispensingForm:new window.Form({ledger_id:this.invoice.id,store_id:null,item_id:null,vendor_id:null,date:(new Date).toISOString().slice(0,10),quantity:1,unit_price:0,prescription_id:"",comments:"",items:[]}),availableStock:0}},computed:{},watch:{"dispensingForm.store_id":function(t){var i=this;t&&this.$httpClient.get("/available_stock/"+this.selectedPrescription.item_id+"/"+t).then((function(t){var s=t.data;i.availableStock=s})).catch((function(t){console.log(t)}))},"dispensingForm.item_id":function(t){t&&this.findProductPriceSetup(t)}},methods:{setupStoreAndPrice:function(){var t=this.stores.find((function(t){return"Pharmacy"===t.name}));this.dispensingForm.store_id=t.id},showDispensingForm:function(t){this.reset(),this.selectedPrescription=t,this.dispensingForm.prescription_id=t.prescription_id,this.dispensingForm.item_id=t.item_id,this.dispensingForm.quantity=parseInt(t.prescription_quantity)+parseInt(t.prescription_issued_qty),this.$bvModal.show("dispensing-modal")},dispense:function(){var t=this,i=this,s={description:this.items.find((function(t){return t.id===i.dispensingForm.item_id})).name,item_id:this.dispensingForm.item_id,quantity:this.dispensingForm.quantity,unit_price:this.dispensingForm.unit_price,ledger_id:this.dispensingForm.ledger_id,store_id:this.dispensingForm.store_id,prescription_id:this.dispensingForm.prescription_id};this.dispensingForm.items.push(s),this.dispensingForm.post("/patient-bills").then((function(){t.$toast.success("Prescription has been dispensed"),t.$bvModal.hide("dispensing-modal"),t.$emit("bill-added")})).catch()},findProductPriceSetup:function(t){var i=this.items.find((function(i){return i.id===t}));0===this.invoice.wallet.type&&(this.dispensingForm.unit_price=.01*i.cash_price.charge_value),1===this.invoice.wallet.type&&(this.dispensingForm.unit_price=.01*i.scheme_price.charge_value)},reset:function(){this.dispensingForm.store_id="",this.availableStock=0,this.selectedPrescription="",this.dispensingForm.prescription_id="",this.dispensingForm.item_id="",this.dispensingForm.quantity=0}}};const n=(0,s(1900).Z)(e,(function(){var t=this,i=t._self._c;return i("div",[i("b-modal",{attrs:{id:"prescriptions-modal",title:"Prescriptions","no-close-on-backdrop":"","footer-class":"d-flex justify-content-between bg-muted-lt border-top","content-class":"bg-white rounded-3","modal-class":"modal-blur","body-class":"px-4","hide-header-close":"","no-close-on-esc":"","no-enforce-focus":"",size:"lg"},scopedSlots:t._u([{key:"modal-footer",fn:function(s){var e=s.cancel;return[i("button",{staticClass:"btn",on:{click:e}},[t._v("\n        Close\n      ")])]}}])},[i("div",{staticClass:"row row-cards"},[i("div",{staticClass:"space-y"},t._l(t.prescriptions,(function(s){return i("div",{key:s.prescription_id,staticClass:"card"},[i("div",{staticClass:"row g-0"},[i("div",{staticClass:"col"},[i("div",{staticClass:"card-body"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("h3",{staticClass:"mb-0"},[i("a",{attrs:{href:"#"},on:{click:function(i){return i.preventDefault(),t.showDispensingForm(s)}}},[t._v("\n                        "+t._s(s.item_name))])])])]),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"col-md"},[i("div",{staticClass:"mt-2 list-inline list-inline-dots mb-0 text-muted d-sm-block d-none"},[i("div",{staticClass:"list-inline-item"},[i("i",{staticClass:"uil uil-prescription-bottle text-indigo"}),t._v("\n                        "+t._s(s.prescription_dosage)+"\n                      ")]),t._v(" "),i("div",{staticClass:"list-inline-item"},[i("i",{staticClass:"uil uil-clock text-teal"}),t._v("\n                        "+t._s(s.prescription_frequency)+" times\n                      ")]),t._v(" "),i("div",{staticClass:"list-inline-item"},[i("i",{staticClass:"uil uil-calender"}),t._v("\n                        "+t._s(s.prescription_duration)+" days\n                      ")])])]),t._v(" "),i("div",{staticClass:"col-md-auto"},[i("div",{staticClass:"mt-3 badges"},[i("a",{staticClass:"badge badge-outline text-muted border fw-normal badge-pill",attrs:{href:"#"},on:{click:function(i){return t.showDispensingForm(s)}}},[t._v("Dispense")])])])])])])])])})),0)])]),t._v(" "),i("b-modal",{attrs:{id:"dispensing-modal","hide-header-close":"",title:"Dispense Prescription","no-close-on-backdrop":"","content-class":"rounded-3 bg-white","footer-class":"d-flex justify-content-end border-top bg-muted-lt pt-2",size:"lg"},on:{shown:t.setupStoreAndPrice,hidden:t.reset},scopedSlots:t._u([{key:"modal-footer",fn:function(s){var e=s.cancel;return[i("button",{staticClass:"btn btn-light me-2",attrs:{disabled:t.dispensingForm.processing},on:{click:function(t){return t.preventDefault(),e.apply(null,arguments)}}},[t._v("\n        Close\n      ")]),t._v(" "),i("button",{staticClass:"btn btn-primary",attrs:{disabled:t.dispensingForm.processing},on:{click:function(i){return i.preventDefault(),t.dispense.apply(null,arguments)}}},[t._v("\n        Dispense\n      ")])]}}])},[t.selectedPrescription?i("div",[i("div",{staticClass:"form-group mb-4"},[i("label",{staticClass:"form-label",attrs:{for:""}},[t._v("Drug")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedPrescription.item_name,expression:"selectedPrescription.item_name"}],staticClass:"form-control bg-muted-lt",attrs:{type:"text",disabled:""},domProps:{value:t.selectedPrescription.item_name},on:{input:function(i){i.target.composing||t.$set(t.selectedPrescription,"item_name",i.target.value)}}})]),t._v(" "),i("div",{staticClass:"form-group mb-4"},[i("label",{staticClass:"form-label",attrs:{for:"item_id"}},[t._v("Price")]),t._v(" "),i("medic-money",{attrs:{disabled:"",value:t.dispensingForm.unit_price},on:{input:function(i){t.dispensingForm.unit_price=i}}})],1),t._v(" "),i("div",{staticClass:"form-group mb-4"},[i("label",{staticClass:"form-label",attrs:{for:""}},[t._v("Dispensing Store")]),t._v(" "),i("v-select",{attrs:{id:"store_id",options:t.stores,label:"name",reduce:function(t){return t.id},clearable:!1},model:{value:t.dispensingForm.store_id,callback:function(i){t.$set(t.dispensingForm,"store_id",i)},expression:"dispensingForm.store_id"}}),t._v(" "),i("span",{staticClass:"small text-indigo"},[t._v("Available Stock: "+t._s(t.availableStock)+" Units")]),t._v(" "),i("br"),t._v(" "),t.dispensingForm.hasError("store_id")?i("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.dispensingForm.getError("store_id"))}}):t._e()],1),t._v(" "),i("div",{staticClass:"form-group mb-4"},[i("label",{staticClass:"form-label",attrs:{for:""}},[t._v("Quantity to Dispense")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.dispensingForm.quantity,expression:"dispensingForm.quantity"}],staticClass:"form-control",attrs:{type:"number"},domProps:{value:t.dispensingForm.quantity},on:{input:function(i){i.target.composing||t.$set(t.dispensingForm,"quantity",i.target.value)}}}),t._v(" "),t.dispensingForm.errors.has("quantity")?i("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.dispensingForm.getError("quantity"))}}):t._e()]),t._v(" "),i("p",{staticClass:"card-subtitle"},[t._v("\n        The doctor has prescribed "+t._s(t.selectedPrescription.prescription_dosage)+"\n        to be taken "),i("span",{staticClass:"text-indigo"},[t._v(" "+t._s(t.selectedPrescription.prescription_frequency)+" times ")]),t._v("\n        a day for "),i("span",{staticClass:"text-indigo"},[t._v(" "+t._s(t.selectedPrescription.prescription_duration)+" day(s)")])])]):t._e()])],1)}),[],!1,null,null,null).exports}}]);