"use strict";(self.webpackChunkmedic_hospital_management=self.webpackChunkmedic_hospital_management||[]).push([[11],{9478:(t,e,i)=>{i.d(e,{Z:()=>o});var s=i(1519),a=i.n(s)()((function(t){return t[1]}));a.push([t.id,".styled-table[data-v-ebce6fdc]{//line-height:10px;border-collapse:collapse;margin:0;min-width:100%}.styled-table thead tr[data-v-ebce6fdc]{background-color:#f4f5f7;color:#111;text-align:left}.styled-table td[data-v-ebce6fdc],.styled-table th[data-v-ebce6fdc]{padding:6px 10px}.styled-table tbody tr[data-v-ebce6fdc]{//border-bottom:1px solid #ddd}.styled-table tbody tr td[data-v-ebce6fdc]{border:1px solid #f3f3f3}.styled-table tbody tr[data-v-ebce6fdc]:nth-of-type(2n){//background-color:#f3f3f3}.styled-table tbody tr.active-row[data-v-ebce6fdc]{color:#009879;font-weight:700}",""]);const o=a},11:(t,e,i)=>{i.r(e),i.d(e,{default:()=>l});const s={props:{visitId:{type:Number,required:!0},invoice:{type:Object,required:!0},customer:{type:Object,required:!0},items:{type:Array,required:!0},stores:{type:Array,required:!0},doctors:{type:Array,default:function(){return[]}}},data:function(){return{form:new window.Form({ledger_id:this.invoice.id,store_id:null,item:null,vendor_id:null,quantity:1,unit_price:0,date:(new Date).toISOString().slice(0,10),comments:"",items:[]}),showStore:!1,showVendor:!1,assignedTo:[],availableStock:0,enableForm:!1}},computed:{selectedProduct:function(){if(!this.form.item)return!1;var t=this;return this.items.find((function(e){return e.id===t.form.item.id}))},formFilledCorrectly:function(){return!!this.form.item&&(!(this.form.item.item_type.is_inventory&&!this.form.store_id)&&((!this.form.item.item_type.is_inventory||0!==this.availableStock)&&!(this.form.item&&this.assignedTo.length>0&&!this.form.vendor_id)))},totalDraftBills:function(){return this.form.items.length?this.form.items.reduce((function(t,e){return t+e.unit_price*e.quantity}),0):0}},watch:{"form.item":function(t){this.showStore=!1,this.showVendor=!1,this.assignedTo=[],this.form.vendor_id=null,this.form.store_id=null,t&&(this.setupProductPriceSetup(t),this.displayStoreSelection(t),this.displayDoctorsAssigned(),this.findAvailableStock())},"form.store_id":function(t){t&&this.findAvailableStock()}},created:function(){this.$bvModa.show("billing-modal")},methods:{toggleForm:function(){this.$bvModal.show("billing-modal")},addBill:function(){this.formFilledCorrectly?this.form.items.push({item:this.form.item,item_id:this.form.item.id,quantity:this.form.quantity,unit_price:this.form.unit_price,vendor_id:this.form.vendor_id,store_id:this.form.store_id,description:this.form.item.name,instruction:null}):this.$toast.error("Please fill the form correctly")},removeBill:function(t){var e=this.form.items.indexOf(t);e>-1&&this.form.items.splice(e,1)},chargePatient:function(){var t=this;this.form.items.length?this.form.post("/patient-bills").then((function(){t.$toast.success("The bill has been charged"),t.cleanUp(),t.$emit("bill-added")})).catch((function(e){t.form.processing=!1,t.form.errors.record(e.response.data.errors)})):this.$toast.error("Please select the product to be charged")},displayStoreSelection:function(t){if(!0===t.item_type.is_inventory){this.showStore=!0;var e=this.stores.find((function(t){return"Pharmacy"===t.name}));this.form.store_id=e.id}},displayDoctorsAssigned:function(){var t=this,e=this.items.find((function(e){return e.id===t.form.item.id}));e&&e.assignments.length&&(this.assignedTo=e.assignments.map((function(t){return t.vendor})),1===this.assignedTo.length&&(this.form.vendor_id=this.assignedTo[0].id),this.showVendor=!0)},setupProductPriceSetup:function(t){0===this.invoice.wallet.type&&(this.form.unit_price=.01*t.cash_price.charge_value),1===this.invoice.wallet.type&&(this.form.unit_price=.01*t.scheme_price.charge_value)},findAvailableStock:function(){var t=this;this.availableStock=0,this.selectedProduct&&this.form.store_id&&this.$httpClient.get("/available_stock/"+this.selectedProduct.id+"/"+this.form.store_id).then((function(e){var i=e.data;t.availableStock=i})).catch()},cleanUp:function(){this.form.reset(),this.showStore=!1,this.showVendor=!1,this.assignedTo=[]}}};var a=i(3379),o=i.n(a),n=i(9478),r={insert:"head",singleton:!1};o()(n.Z,r);n.Z.locals;const l=(0,i(1900).Z)(s,(function(){var t=this,e=t._self._c;return e("div",[e("b-modal",{attrs:{id:"billing-modal",title:"Billing","footer-class":"d-flex justify-content-between bg-muted-lt border-top","content-class":"bg-white rounded-3","body-class":"px-4",size:"xl","no-close-on-backdrop":"","hide-header-close":"","no-close-on-esc":"","no-enforce-focus":""},on:{hidden:t.cleanUp},scopedSlots:t._u([{key:"modal-footer",fn:function(i){var s=i.close;return[e("button",{staticClass:"btn",attrs:{disabled:t.form.processing},on:{click:function(t){return t.preventDefault(),s.apply(null,arguments)}}},[t._v("Close")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{disabled:t.form.processing},on:{click:function(e){return e.preventDefault(),t.chargePatient.apply(null,arguments)}}},[t._v("Charge\n            ")])]}}])},[e("form",{attrs:{action:""},on:{submit:function(e){return e.preventDefault(),t.chargePatient.apply(null,arguments)}}},[e("div",{staticClass:"row gx-4"},[e("div",{staticClass:"col-xl-4"},[e("div",{staticClass:"form-group"},[e("label",{staticClass:"form-label",attrs:{id:"item_id"}},[t._v("Product")]),t._v(" "),e("v-select",{attrs:{id:"item_id",options:t.items,label:"name",reduce:function(t){return t},clearable:!1},scopedSlots:t._u([{key:"option",fn:function(i){return[e("div",[e("div",{staticClass:"font-weight-medium"},[t._v("\n                                        "+t._s(i.name)+"\n                                    ")]),t._v(" "),"Inventory"===i.item_type.name?e("div",{staticClass:"text-teal small my-0"},[t._v("\n                                        "+t._s(i.item_type.name)+"\n                                    ")]):t._e(),t._v(" "),"Service"===i.item_type.name?e("div",{staticClass:"text-indigo small my-0"},[t._v("\n                                        "+t._s(i.item_type.name)+"\n                                    ")]):t._e()])]}}]),model:{value:t.form.item,callback:function(e){t.$set(t.form,"item",e)},expression:"form.item"}})],1)]),t._v(" "),e("div",{staticClass:"col-xl-2"},[e("div",{staticClass:"form-group"},[e("label",{staticClass:"form-label",attrs:{for:"qty"}},[t._v("Qty")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.quantity,expression:"form.quantity"}],staticClass:"form-control",attrs:{id:"qty",name:"quantity",type:"number",min:"1"},domProps:{value:t.form.quantity},on:{input:function(e){e.target.composing||t.$set(t.form,"quantity",e.target.value)}}}),t._v(" "),t.form.item&&0===t.invoice.wallet.type?e("span",{staticClass:"small"},[t._v("Price: "+t._s(t._f("toMoneyFormat")(t.form.item.cash_price.charge_value*t.form.quantity*.01)))]):t._e(),t._v(" "),t.form.item&&1===t.invoice.wallet.type?e("span",{staticClass:"small"},[t._v("Price:  "+t._s(t._f("toMoneyFormat")(t.form.item.scheme_price.charge_value*t.form.quantity*.01)))]):t._e(),t._v(" "),t.form.hasError("quantity")?e("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.getError("quantity"))}}):t._e()])]),t._v(" "),e("div",{staticClass:"col-xl-3"},[e("div",{staticClass:"form-group"},[e("label",{staticClass:"form-label",attrs:{for:"store_id"}},[t._v("Store")]),t._v(" "),e("v-select",{attrs:{id:"store_id",disabled:!t.form.item||t.form.item&&!1===t.form.item.item_type.is_inventory,options:t.stores,label:"name",reduce:function(t){return t.id},clearable:!0},model:{value:t.form.store_id,callback:function(e){t.$set(t.form,"store_id",e)},expression:"form.store_id"}}),t._v(" "),t.form.item&&t.form.item.item_type.is_inventory&&t.form.store_id?e("span",{staticClass:"small text-indigo mt-2"},[t._v("Available Stock: "+t._s(t.availableStock)+" units")]):t._e()],1)]),t._v(" "),e("div",{staticClass:"col-xl-3"},[e("div",{staticClass:"form-group"},[e("label",{staticClass:"form-label",attrs:{for:"vendor_id"}},[t._v("Assign to")]),t._v(" "),e("v-select",{attrs:{id:"vendor_id",disabled:!1===t.showVendor,options:t.assignedTo,label:"name",reduce:function(t){return t.id},clearable:!0},model:{value:t.form.vendor_id,callback:function(e){t.$set(t.form,"vendor_id",e)},expression:"form.vendor_id"}})],1)])]),t._v(" "),e("button",{staticClass:"btn mt-2",on:{click:function(e){return e.preventDefault(),t.addBill.apply(null,arguments)}}},[e("i",{staticClass:"uil uil-save me-1"}),t._v(" Save\n            ")]),t._v(" "),e("div",{staticClass:"mt-3"},[e("table",{staticClass:"styled-table"},[e("thead",[e("tr",[e("th",{staticClass:"ps-3",staticStyle:{width:"60%"}},[t._v("\n                            Description\n                        ")]),t._v(" "),e("th",{staticClass:"pe-3 text-center",staticStyle:{width:"10%"}},[t._v("\n                            Qty\n                        ")]),t._v(" "),e("th",{staticClass:"pe-3 text-end",staticStyle:{width:"10%"}},[t._v("\n                            Price\n                        ")]),t._v(" "),e("th",{staticClass:"pe-3 text-end",staticStyle:{width:"10%"}},[t._v("\n                            Amount\n                        ")]),t._v(" "),e("th",{staticClass:"pe-3",staticStyle:{width:"10%"}})])]),t._v(" "),e("tbody",t._l(t.form.items,(function(i){return e("tr",[e("td",{staticClass:"ps-3"},[t._v("\n                            "+t._s(i.item.name)+"\n                        ")]),t._v(" "),e("td",{staticClass:"pe-3 text-center"},[t._v("\n                            "+t._s(i.quantity)+"\n                        ")]),t._v(" "),e("td",{staticClass:"pe-3 text-end"},[t._v("\n                            "+t._s(t._f("toMoneyFormat")(i.unit_price))+"\n                        ")]),t._v(" "),e("td",{staticClass:"pe-3 text-end"},[t._v("\n                            "+t._s(t._f("toMoneyFormat")(i.unit_price*i.quantity))+"\n                        ")]),t._v(" "),e("td",{staticClass:"pe-3 text-center"},[e("a",{staticClass:"text-danger",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.removeBill(i)}}},[t._v("Remove")])])])})),0),t._v(" "),e("tfoot",[e("tr",[e("td"),t._v(" "),e("td"),t._v(" "),e("td"),t._v(" "),e("td",{staticClass:"text-end pe-3 text-indigo"},[t._v("\n                            "+t._s(t._f("toMoneyFormat")(Math.round(t.totalDraftBills)))+"\n                        ")])])])])]),t._v(" "),t.form.processing?e("div",{staticClass:"progress mb-2"},[e("div",{staticClass:"progress"},[e("div",{staticClass:"progress-bar progress-bar-indeterminate bg-green"})])]):t._e()])]),t._v(" "),t.enableForm?e("div",{staticClass:"card mb-4 card-stacked"},[e("div",{staticClass:"card-body px-4"},[e("div",{staticClass:"row gx-4 mb-4"},[e("div",{staticClass:"col-xl-4"},[e("div",{staticClass:"form-group mb-4"},[e("label",{staticClass:"form-label",attrs:{id:"item_id"}},[t._v("Product")]),t._v(" "),e("v-select",{attrs:{id:"item_id",options:t.items,label:"name",reduce:function(t){return t},clearable:!1},scopedSlots:t._u([{key:"option",fn:function(i){return[e("div",[e("div",{staticClass:"font-weight-medium"},[t._v("\n                                        "+t._s(i.name)+"\n                                    ")]),t._v(" "),"Inventory"===i.item_type.name?e("div",{staticClass:"text-teal small my-0"},[t._v("\n                                        "+t._s(i.item_type.name)+"\n                                    ")]):t._e(),t._v(" "),"Service"===i.item_type.name?e("div",{staticClass:"text-indigo small my-0"},[t._v("\n                                        "+t._s(i.item_type.name)+"\n                                    ")]):t._e()])]}}],null,!1,396529591),model:{value:t.form.item,callback:function(e){t.$set(t.form,"item",e)},expression:"form.item"}})],1)]),t._v(" "),e("div",{staticClass:"col-xl-1"},[e("div",{staticClass:"form-group mb-4"},[e("label",{staticClass:"form-label",attrs:{for:"qty"}},[t._v("Qty")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.quantity,expression:"form.quantity"}],staticClass:"form-control",attrs:{id:"qty",name:"quantity",type:"number",min:"1"},domProps:{value:t.form.quantity},on:{input:function(e){e.target.composing||t.$set(t.form,"quantity",e.target.value)}}}),t._v(" "),t.form.item&&0===t.invoice.wallet.type?e("span",{staticClass:"small"},[t._v("Price: "+t._s(t._f("toMoneyFormat")(t.form.item.cash_price.charge_value*t.form.quantity*.01)))]):t._e(),t._v(" "),t.form.item&&1===t.invoice.wallet.type?e("span",{staticClass:"small"},[t._v("Price:  "+t._s(t._f("toMoneyFormat")(t.form.item.scheme_price.charge_value*t.form.quantity*.01)))]):t._e(),t._v(" "),t.form.hasError("quantity")?e("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.getError("quantity"))}}):t._e()])]),t._v(" "),e("div",{staticClass:"col-xl-3"},[e("div",{staticClass:"form-group mb-4"},[e("label",{staticClass:"form-label",attrs:{for:"store_id"}},[t._v("Store")]),t._v(" "),e("v-select",{attrs:{id:"store_id",disabled:!t.form.item||t.form.item&&!1===t.form.item.item_type.is_inventory,options:t.stores,label:"name",reduce:function(t){return t.id},clearable:!0},model:{value:t.form.store_id,callback:function(e){t.$set(t.form,"store_id",e)},expression:"form.store_id"}}),t._v(" "),t.form.item&&t.form.item.item_type.is_inventory&&t.form.store_id?e("span",{staticClass:"small text-indigo mt-2"},[t._v("Available Stock: "+t._s(t.availableStock)+" units")]):t._e()],1)]),t._v(" "),e("div",{staticClass:"col-xl-3"},[e("div",{staticClass:"form-group mb-3"},[e("label",{staticClass:"form-label",attrs:{for:"vendor_id"}},[t._v("Assign to")]),t._v(" "),e("v-select",{attrs:{id:"vendor_id",disabled:!1===t.showVendor,options:t.assignedTo,label:"name",reduce:function(t){return t.id},clearable:!0},model:{value:t.form.vendor_id,callback:function(e){t.$set(t.form,"vendor_id",e)},expression:"form.vendor_id"}})],1)]),t._v(" "),e("div",{staticClass:"col-xl-1"},[e("button",{staticClass:"btn",on:{click:function(e){return e.preventDefault(),t.addBill.apply(null,arguments)}}},[e("i",{staticClass:"uil uil-plus"})])])]),t._v(" "),e("table",{staticClass:"styled-table"},[t._m(0),t._v(" "),e("tbody",t._l(t.form.items,(function(i){return e("tr",[e("td",{staticClass:"ps-3"},[t._v("\n                        "+t._s(i.item.name)+"\n                    ")]),t._v(" "),e("td",{staticClass:"pe-3 text-center"},[t._v("\n                        "+t._s(i.quantity)+"\n                    ")]),t._v(" "),e("td",{staticClass:"pe-3 text-end"},[t._v("\n                        "+t._s(t._f("toMoneyFormat")(i.unit_price))+"\n                    ")]),t._v(" "),e("td",{staticClass:"pe-3 text-end"},[t._v("\n                        "+t._s(t._f("toMoneyFormat")(i.unit_price*i.quantity))+"\n                    ")]),t._v(" "),e("td",{staticClass:"pe-3 text-end"},[t._v("\n                        "+t._s(i.vendor)+"\n                    ")]),t._v(" "),e("td",{staticClass:"pe-3 text-center"},[e("div",{staticClass:"btn-list"},[e("button",{staticClass:"btn btn-icon py-1",on:{click:function(e){return e.preventDefault(),t.removeBill(i)}}},[e("i",{staticClass:"uil uil-trash-alt text-danger"})])])])])})),0),t._v(" "),e("tfoot",[e("tr",[e("td"),t._v(" "),e("td"),t._v(" "),e("td"),t._v(" "),e("td",{staticClass:"text-end pe-3 text-indigo"},[t._v("\n                        "+t._s(t._f("toMoneyFormat")(Math.round(t.totalDraftBills)))+"\n                    ")])])])])]),t._v(" "),e("div",{staticClass:"card-footer"},[e("button",{staticClass:"btn btn-success",attrs:{disabled:t.form.processing},on:{click:function(e){return e.preventDefault(),t.chargePatient.apply(null,arguments)}}},[t._v("\n                Submit\n            ")]),t._v(" "),e("button",{staticClass:"btn me-3",attrs:{disabled:t.form.processing},on:{click:t.toggleForm}},[t._v("\n                Close\n            ")])])]):t._e()],1)}),[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",{staticClass:"ps-3",staticStyle:{width:"45%"}},[t._v("\n                        Description\n                    ")]),t._v(" "),e("th",{staticClass:"pe-3 text-center",staticStyle:{width:"10%"}},[t._v("\n                        Qty\n                    ")]),t._v(" "),e("th",{staticClass:"pe-3 text-end",staticStyle:{width:"10%"}},[t._v("\n                        Price\n                    ")]),t._v(" "),e("th",{staticClass:"pe-3 text-end",staticStyle:{width:"10%"}},[t._v("\n                        Amount\n                    ")]),t._v(" "),e("th",{staticClass:"pe-3",staticStyle:{width:"15%"}},[t._v("\n                        Assigned To\n                    ")]),t._v(" "),e("th",{staticClass:"pe-3",staticStyle:{width:"10%"}})])])}],!1,null,"ebce6fdc",null).exports}}]);