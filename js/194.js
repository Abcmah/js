"use strict";(self.webpackChunkmedic_hospital_management=self.webpackChunkmedic_hospital_management||[]).push([[194],{7194:(t,e,s)=>{s.r(e),s.d(e,{default:()=>n});var i=s(538),a=s(4801);const r=(0,i.defineComponent)({name:"ProcedureBills",props:{items:{type:Array,default:function(){return[]}},permissions:{type:Array,default:function(){return[]}},stores:{type:Array,default:function(){return[]}},invoice:{type:Object,required:!0},visitRecord:{type:Object,required:!0}},data:function(){return{fields:[{name:"__slot:date",title:"DATE",titleClass:" text-end pe-3",dataClass:" text-end pe-3",width:"8%"},{name:"__slot:description",title:"DESCRIPTION",titleClass:"ps-3",dataClass:"ps-3",width:"45%"},{name:"unit_price",title:"PRICE",callback:function(t){return t<0?"("+(0,a.p)(Math.abs(t)).toFormat("0,0.00")+")":(0,a.p)(t).toFormat("0,0.00")},titleClass:"text-end pe-3",dataClass:"text-end pe-3",width:"10%"},{name:"quantity",title:"QTY",titleClass:"text-center",dataClass:"text-center",width:"5%"},{name:"total",title:"TOTAL",callback:function(t){return t<0?"("+(0,a.p)(Math.abs(t)).toFormat("0,0.00")+")":(0,a.p)(t).toFormat("0,0.00")},titleClass:"text-end pe-3",dataClass:"text-end pe-3",width:"10%"},{name:"__slot:billed_by",title:"BILLED BY",dataClass:"ps-3",titleClass:"ps-3",width:"15%"},{name:"__slot:actions",dataClass:"txt-center",width:"5%"}],bills:[],billToReverse:"",form:new window.Form({ledger_id:this.invoice.id,store_id:null,item:null,vendor_id:null,quantity:1,unit_price:0,date:(new Date).toISOString().slice(0,10),comments:"",items:[]}),showStore:!1,showVendor:!1,assignedTo:[],availableStock:0,enableForm:!1,reverseForm:new window.Form({comments:"",detail_id:"",ledger_id:this.invoice.id,source:"1"}),selectedBill:""}},computed:{invoiceNotClosed:function(){return null===this.invoice.processed_at},selectedProduct:function(){if(!this.form.item)return!1;var t=this;return this.items.find((function(e){return e.id===t.form.item.id}))}},watch:{"form.item":function(t){this.showStore=!1,this.showVendor=!1,this.assignedTo=[],this.form.vendor_id=null,this.form.store_id=null,t&&(this.setupProductPriceSetup(t),this.displayStoreSelection(t),this.displayDoctorsAssigned(),this.findAvailableStock())},"form.store_id":function(t){t&&this.findAvailableStock()}},mounted:function(){this.retrievePatientBills()},methods:{retrievePatientBills:function(){var t=this;this.$httpClient.get("/patient-billing/patient-bills/"+this.invoice.hashid).then((function(e){var s=e.data;t.bills=s.bills.filter((function(t){return t.procedure&&"Laboratory"!==t.department_name}))})).catch((function(){t.$toast.error("There was a problem retrieving the patient bills")}))},openBillingModal:function(){this.$bvModal.show("procedure-bills-modal")},setupProductPriceSetup:function(t){0===this.invoice.wallet.type&&(this.form.unit_price=t.cash_price?.01*t.cash_price.charge_value:0),1===this.invoice.wallet.type&&(this.form.unit_price=t.scheme_price?.01*t.scheme_price.charge_value:0)},chargePatient:function(){var t=this;this.selectedProduct?(this.form.items.push({item:this.form.item,item_id:this.form.item.id,quantity:this.form.quantity,unit_price:this.form.unit_price,vendor_id:this.form.vendor_id,store_id:this.form.store_id,description:this.form.item.name,instruction:null}),this.form.post("/patient-bills").then((function(){t.$toast.success("The bill has been charged"),t.cleanUp(),t.$emit("bill-added")})).catch((function(e){t.form.processing=!1,t.form.errors.record(e.response.data.errors)}))):this.$toast.error("Please select a product to be charged")},openReverseForm:function(t){if(t.is_payment||t.paid)return this.$toast.warning("You cannot reverse payment / paid bills. Consider using refund");this.billToReverse=t,this.reverseForm.detail_id=t.id,this.$bvModal.show("procedure-reverse-modal")},reverseBills:function(){var t=this;this.reverseForm.post("/bills/reverse").then((function(){t.$toast.info("Bill deleted successfully"),t.$emit("bills:reversed"),t.$bvModal.hide("lab-reverse-modal"),t.cleanUp()})).catch((function(e){t.$toast.error("The bill could not be reversed")}))},cleanUp:function(){this.billToReverse="",this.retrievePatientBills()},openResultsModal:function(t){var e=this;this.selectedBill=t,0===this.invoice.cash_credit&&t.total>0&&t.paid,setTimeout((function(){e.$refs.resultsManager.openResultsModal()}),1e3)}}});const n=(0,s(1900).Z)(r,(function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("b-modal",{attrs:{id:"procedure-bills-modal","body-class":"px-4","content-class":"bg-white rounded-3","footer-class":"d-flex justify-content-between bg-muted-lt border-top","hide-header-close":"","modal-class":"modal-blur","no-close-on-backdrop":"","no-close-on-esc":"","no-enforce-focus":"",title:"Billing Form"},on:{hidden:t.cleanUp},scopedSlots:t._u([{key:"modal-footer",fn:function(s){var i=s.cancel;return[e("button",{staticClass:"btn",attrs:{disabled:t.form.processing,type:"button"},on:{click:function(t){return t.preventDefault(),i.apply(null,arguments)}}},[t._v("\n                Close\n            ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{disabled:t.form.processing,type:"submit"},on:{click:t.chargePatient}},[t._v("\n                Submit\n            ")])]}}])},[e("div",{staticClass:"form-group mb-4"},[e("label",{staticClass:"form-label",attrs:{for:"item_id"}},[t._v("Product")]),t._v(" "),e("v-select",{attrs:{id:"item_id",clearable:!1,options:t.items,label:"name"},scopedSlots:t._u([{key:"selected-option",fn:function(s){return[e("div",[e("div",{staticClass:"font-weight-medium"},[t._v("\n                            "+t._s(s.name)+"\n                        ")]),t._v(" "),0===t.invoice.cash_credit?e("div",{staticClass:"text-primary small"},[t._v("\n                            KES "+t._s(t._f("toMoneyFormat")(s.cash_price?.01*s.cash_price.charge_value:0))+"\n                        ")]):e("div",{staticClass:"text-primary small"},[t._v("\n                            KES "+t._s(t._f("toMoneyFormat")(s.scheme_price?.01*s.scheme_price.charge_value:0))+"\n                        ")])])]}}]),model:{value:t.form.item,callback:function(e){t.$set(t.form,"item",e)},expression:"form.item"}}),t._v(" "),t.form.errors.has("item_id")?e("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.errors.first("item_id"))}}):t._e(),t._v(" "),t.form.hasError("ledger_id")?e("p",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.getError("ledger_id"))}}):t._e()],1),t._v(" "),t.form.processing?e("div",{staticClass:"progress mb-2"},[e("div",{staticClass:"progress"},[e("div",{staticClass:"progress-bar progress-bar-indeterminate bg-green"})])]):t._e()]),t._v(" "),e("b-modal",{attrs:{id:"procedure-reverse-modal","body-class":"text-center p-4","footer-class":"d-flex justify-content-center bg-white pt-2","header-bg-variant":"danger","header-text-variant":"light","hide-header-close":"","modal-class":"modal-blur","no-close-on-backdrop":"","no-close-on-esc":"","no-enforce-focus":"",title:"DELETE BILL"},scopedSlots:t._u([{key:"modal-footer",fn:function(s){var i=s.cancel;return[e("button",{staticClass:"btn btn-light",attrs:{disabled:t.reverseForm.processing},on:{click:i}},[t._v("\n                Close\n            ")]),t._v(" "),e("button",{staticClass:"btn btn-danger",attrs:{disabled:t.reverseForm.processing,form:"reverseForm",type:"submit"},on:{click:t.reverseBills}},[t._v("\n                Delete Bill\n            ")])]}}])},[e("div",{staticClass:"mb-4"},[e("svg",{staticClass:"icon mb-2 text-danger icon-lg",attrs:{fill:"none",height:"24",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M0 0h24v24H0z",fill:"none",stroke:"none"}}),t._v(" "),e("path",{attrs:{d:"M12 9v2m0 4v.01"}}),t._v(" "),e("path",{attrs:{d:"M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75"}})]),t._v(" "),e("h3",{staticClass:"font-weight-bold mb-0 pb-0"},[t._v("\n                Are you sure?\n            ")]),t._v(" "),e("div",{staticClass:"text-muted"},[t._v("\n                Do you really want to delete the bill? This action cannot be undone.\n            ")])]),t._v(" "),e("form",{attrs:{id:"reverseForm"},on:{submit:function(e){return e.preventDefault(),t.reverseBills.apply(null,arguments)}}},[e("div",{staticClass:"mb-3"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.reverseForm.comments,expression:"reverseForm.comments"}],staticClass:"form-control",attrs:{placeholder:"Briefly explain why you are deleting  the bill",required:""},domProps:{value:t.reverseForm.comments},on:{input:function(e){e.target.composing||t.$set(t.reverseForm,"comments",e.target.value)}}})]),t._v(" "),t.reverseForm.hasError("header_id")?e("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.reverseForm.getError("header_id"))}}):t._e()]),t._v(" "),t.reverseForm.processing?e("div",{staticClass:"progress mb-2"},[e("div",{staticClass:"progress"},[e("div",{staticClass:"progress-bar progress-bar-indeterminate bg-green"})])]):t._e()]),t._v(" "),e("div",{staticClass:"card rounded-3 mb-5"},[e("div",{staticClass:"card-header"},[t._m(0),t._v(" "),e("div",{staticClass:"card-actions"},[e("div",{staticClass:"btn-list"},[t.invoiceNotClosed?e("button",{staticClass:"btn btn-primary me-4",on:{click:function(e){return e.preventDefault(),t.openBillingModal.apply(null,arguments)}}},[e("i",{staticClass:"uil uil-plus me-1"}),t._v(" Charge Patient\n                    ")]):t._e()])])]),t._v(" "),e("VueTable",{ref:"table",attrs:{"api-mode":!1,data:t.bills,fields:t.fields,"load-on-start":!1,"show-pagination":!1,"show-per-page":!1},scopedSlots:t._u([{key:"date",fn:function(s){return[e("div",{staticClass:"flex-fill"},[e("div",{staticClass:"ps-3"},[t._v("\n                        "+t._s(t._f("date_DATE_MONTH_YEAR")(s.rowData.date))+"\n                    ")]),t._v(" "),e("div",{staticClass:"text-indigo small ps-3"},[t._v("\n                        "+t._s(t._f("tIME_HOUR_MINUTES")(s.rowData.date))+"\n                    ")])])]}},{key:"description",fn:function(s){return[e("div",{staticClass:"flex-fill"},[e("div",{},[t._v("\n                        "+t._s(s.rowData.description)+"\n                    ")]),t._v(" "),e("div",[s.rowData.paid&&!1===s.rowData.is_payment?e("span",{staticClass:"text-success small"},[t._v("Paid")]):t._e(),t._v(" "),s.rowData.paid&&s.rowData.is_payment&&"REFUND"!==s.rowData.instructions?e("span",{staticClass:"text-success small"},[t._v("Payment")]):t._e(),t._v(" "),s.rowData.paid&&s.rowData.is_payment&&"REFUND"===s.rowData.instructions?e("span",{staticClass:"text-purple small"},[t._v("Refund")]):t._e(),t._v(" "),!s.rowData.paid&&Number.parseFloat(s.rowData.unit_price)>0&&!1===s.rowData.is_discount?e("span",{staticClass:"text-danger small"},[t._v("Unpaid")]):t._e()]),t._v(" "),s.rowData.result_done?e("div",{staticClass:"col-auto align-self-center"},[e("div",{staticClass:"badge bg-success badge-pill"}),t._v(" "),e("small",[t._v("Result entered")])]):t._e()])]}},{key:"billed_by",fn:function(s){return[e("div",{staticClass:"d-flex align-items-center"},[e("div",{staticClass:"flex-fill"},[e("div",{staticClass:"font-weight-medium"},[t._v("\n                            "+t._s(s.rowData.billed_by)+"\n                        ")]),t._v(" "),e("small",{staticClass:"text-muted text-truncate small"},[t._v("\n                            "+t._s(s.rowData.user_department)+"\n                        ")])])])]}},{key:"status",fn:function(s){return[e("div",[s.rowData.paid&&!1===s.rowData.is_payment?e("span",{staticClass:"badge bg-teal-lt badge-pill"},[t._v("Paid")]):t._e(),t._v(" "),s.rowData.paid&&s.rowData.is_payment?e("span",{staticClass:"badge bg-teal-lt badge-pill"},[t._v("Payment")]):t._e(),t._v(" "),!s.rowData.paid&&Number.parseFloat(s.rowData.unit_price)>0?e("span",{staticClass:"badge badge-pill bg-danger"},[t._v("Unpaid")]):t._e()])]}},{key:"actions",fn:function(s){return[e("div",{staticClass:"dropdown"},[e("button",{staticClass:"btn align-text-center py-1",attrs:{"data-bs-toggle":"dropdown"}},[e("i",{staticClass:"uil uil-ellipsis-h"})]),t._v(" "),e("div",{staticClass:"dropdown-menu dropdown-menu-end"},[s.rowData.templates_count>0?e("div",[e("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.openResultsModal(s.rowData)}}},[e("i",{staticClass:"uil uil-stethoscope me-2 fs-2"}),t._v(" Results Management\n                            ")]),t._v(" "),s.rowData.result_done?e("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.approveResults(s.rowData)}}},[e("i",{staticClass:"uil uil-check me-2 fs-2"}),t._v(" Approve\n                            ")]):t._e()]):t._e(),t._v(" "),e("div",{staticClass:"dropdown-divider"}),t._v(" "),s.rowData.is_payment||s.rowData.paid||s.rowData.done||t.invoiceProcessed?t._e():e("a",{directives:[{name:"can",rawName:"v-can",value:"delete-patient-bill",expression:"'delete-patient-bill'"}],staticClass:"dropdown-item text-danger",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.openReverseForm(s.rowData)}}},[e("i",{staticClass:"uil uil-trash-alt me-2 fs-2"}),t._v(" Delete\n                        ")])])])]}}])})],1)],1)}),[function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{},[e("h2",{staticClass:"card-title mb-0 fw-bold"},[t._v("\n                    Procedures\n                ")])])}],!1,null,"92e0e804",null).exports}}]);