"use strict";(self.webpackChunkmedic_hospital_management=self.webpackChunkmedic_hospital_management||[]).push([[264],{2264:(t,e,s)=>{s.r(e),s.d(e,{default:()=>r});var a=s(1902);const i={props:{visit:{type:Object,required:!0},invoice:{type:Object,required:!0},items:{type:Array,default:function(){return[]}},stores:{type:Array,default:function(){return[]}}},data:function(){return{prescriptions:[],fields:[{name:"prescribed_at",title:"Date",titleClass:"ps-3",dataClass:"ps-3",callback:this.$options.filters.date_DATE_MONTH_YEAR,width:"10%"},{name:"item.name",title:"Drug",titleClass:"ps-3",dataClass:"ps-3 text-truncate",width:"30%"},{name:"dosage",title:"Dosage",titleClass:"ps-3",dataClass:"ps-3",width:"10%"},{name:"frequency",title:"Frequency",titleClass:"ps-3",dataClass:"ps-3",width:"15%",callback:function(t){return t+" times"}},{name:"duration",title:"Duration",titleClass:"ps-3",dataClass:"ps-3",width:"15%",callback:function(t){return t+" day(s)"}},{name:"user.name",title:"Written By",titleClass:"ps-3",dataClass:"ps-3 text-truncate",width:"10%"},{name:"__slot:actions",dataClass:"text-center",width:"10%"}],moreParams:{filter:{patient_id:this.visit.patient_id},include:"items,users",sort:"-created_at"},prescription:{},form:new window.Form({id:null,patient_visit_id:this.visit.id,item_id:"",intake_id:"",comments:"",dosage:"",frequency:1,duration:1,quantity:0,unit_price:0}),viewForm:!1,intakes:[],availableStock:0,priceRecord:0}},computed:{prescriptionsTotal:function(){if(!this.prescriptions.length)return 0;var t=this;return this.prescriptions.reduce((function(e,s){var a=Number(0);return 0===t.invoice.cash_credit&&(a=s.item.cash_price?.01*s.item.cash_price.charge_value:0),1===t.invoice.cash_credit&&(a=s.item.scheme_price?.01*s.item.scheme_price.charge_value:0),Number.parseFloat(a)+e}),0)}},watch:{"moreParams.filter.patient_visit_id":function(t){t&&this.vuetable.refresh()},"form.item_id":function(t){if(t){var e=this.stores.find((function(t){return"Pharmacy"===t.name}));e&&this.findAvailableStock(e.id)}}},created:function(){this.findPrescriptions()},methods:{findPrescriptions:function(){var t=this;this.$httpClient.get("/prescriptions",{params:{filter:{patient_id:this.visit.patient_id}}}).then((function(e){var s=e.data;t.prescriptions=s.data})).catch()},showPrescriptionDetail:function(t){this.prescription=t,this.$bvModal.show("prescription-detail-modal")},createPrescription:function(){var t=this;this.form.post("/prescriptions").then((function(){t.findPrescriptions(),t.$toast.success("Prescription has been added")})).catch((function(t){}))},updatePrescription:function(){var t=this;this.form.patch("/prescriptions/"+this.form.id).then((function(){t.findPrescriptions(),t.$bvModal.hide("prescription-update-modal"),t.$toast.success("Prescription updated")})).catch()},deletePrescription:function(t){var e=this;this.$toast.question("Are you sure","Delete Prescription").then((function(){a.Z.deletePrescription(t.id).then((function(){e.$toast.info("Prescription deleted"),e.findPrescriptions()})).catch((function(){e.$toast.error("Something went wrong! Prescription not deleted")}))}))},findIntakes:function(){var t=this;a.Z.findAllPrescriptionIntake().then((function(e){var s=e.data;t.intakes=s})).catch()},findAvailableStock:function(t){var e=this;this.availableStock=0,this.$httpClient.get("/available_stock/"+this.form.item_id+"/"+t).then((function(t){var s=t.data;e.availableStock=s})).catch((function(t){console.log(t)}))}}};const r=(0,s(1900).Z)(i,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"card rounded-3 mt-3"},[e("div",{staticClass:"card-header"},[e("h2",{staticClass:"page-title"},[t._v("\n        Prescriptions\n      ")]),t._v(" "),e("div",{staticClass:"card-actions"},[e("button",{directives:[{name:"b-modal",rawName:"v-b-modal:prescription-modal",arg:"prescription-modal"}],staticClass:"btn btn-outline-primary",attrs:{disabled:t.visit.posted_at}},[t._v("\n          Prescribe\n        ")])])]),t._v(" "),e("table",{staticClass:"table table-bordered"},[t._m(0),t._v(" "),e("tbody",[t._l(t.prescriptions,(function(s){return e("tr",[e("td",{staticClass:"ps-3"},[t._v("\n            "+t._s(t._f("date_DATE_MONTH_YEAR")(s.prescribed_at))+"\n          ")]),t._v(" "),e("td",{staticClass:"ps-3"},[t._v("\n            "+t._s(s.item.name)+"\n          ")]),t._v(" "),e("td",{staticClass:"ps-3"},[t._v("\n            "+t._s(s.dosage)+"\n          ")]),t._v(" "),e("td",{staticClass:"ps-3"},[t._v("\n            "+t._s(s.frequency)+"\n          ")]),t._v(" "),e("td",{staticClass:"ps-3"},[t._v("\n            "+t._s(s.duration)+"\n          ")]),t._v(" "),e("td",{staticClass:"ps-3"},[t._v("\n            "+t._s(s.user.name)+"\n          ")]),t._v(" "),0===t.invoice.cash_credit?e("td",{staticClass:"ps-3"},[t._v("\n            "+t._s(t._f("toMoneyFormat")(s.item.cash_price?.01*s.item.cash_price.charge_value:0))+"\n          ")]):t._e(),t._v(" "),1===t.invoice.cash_credit?e("td",{staticClass:"ps-3"},[t._v("\n            "+t._s(t._f("toMoneyFormat")(s.item.scheme_price?.01*s.item.scheme_price.charge_value:0))+"\n          ")]):t._e(),t._v(" "),e("td",[e("button",{staticClass:"btn btn-white py-1",on:{click:function(e){return t.deletePrescription(s)}}},[e("i",{staticClass:"uil uil-trash-alt text-danger me-1"})])])])})),t._v(" "),e("tr",[e("td"),t._v(" "),e("td"),t._v(" "),e("td"),t._v(" "),e("td"),t._v(" "),e("td"),t._v(" "),e("td"),t._v(" "),e("td",{staticClass:"ps-2"},[t._v("\n            "+t._s(t._f("toMoneyFormat")(t.prescriptionsTotal))+"\n          ")])])],2)])]),t._v(" "),e("b-modal",{attrs:{id:"prescription-modal",title:"Prescription Form","title-class":"font-18","no-close-on-backdrop":"","hide-header-close":"","modal-class":"modal-blur","content-class":"bg-white rounded-3",size:"lg","footer-class":"d-flex justify-content-between bg-muted-lt border-top"},scopedSlots:t._u([{key:"modal-footer",fn:function(s){var a=s.cancel;return[e("button",{staticClass:"btn btn-light me-2",attrs:{disabled:t.form.processing},on:{click:a}},[t._v("\n        Close\n      ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"submit",disabled:t.form.processing},on:{click:t.createPrescription}},[t._v("\n        Prescribe\n      ")])]}}])},[e("div",{staticClass:"mb-4"},[e("label",{staticClass:"form-label",attrs:{for:""}},[t._v("Medication\n        "),t.form.item_id?e("small",{staticClass:"form-label-description text-indigo"},[t._v("Available stock:\n          "+t._s(t.availableStock)+" units ")]):t._e()]),t._v(" "),e("v-select",{attrs:{options:t.items,label:"name",reduce:function(t){return t.id},clearable:!1,name:"item_id"},scopedSlots:t._u([{key:"selected-option",fn:function(s){return[e("div",[e("div",{staticClass:"font-weight-medium"},[t._v("\n              "+t._s(s.name)+"\n            ")]),t._v(" "),0===t.invoice.cash_credit?e("div",{staticClass:"text-primary small"},[t._v("\n              KES "+t._s(t._f("toMoneyFormat")(s.cash_price?.01*s.cash_price.charge_value:0))+"\n            ")]):e("div",{staticClass:"text-primary small"},[t._v("\n              KES "+t._s(t._f("toMoneyFormat")(s.scheme_price?.01*s.scheme_price.charge_value:0))+"\n            ")])])]}}]),model:{value:t.form.item_id,callback:function(e){t.$set(t.form,"item_id",e)},expression:"form.item_id"}}),t._v(" "),t.form.hasError("item_id")?e("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.getError("item_id"))}}):t._e()],1),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-4"},[e("div",{staticClass:"mb-4"},[e("label",{staticClass:"form-label",attrs:{for:""}},[t._v("Dosage")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.dosage,expression:"form.dosage"}],staticClass:"form-control",attrs:{type:"text",placeholder:"20mg"},domProps:{value:t.form.dosage},on:{input:function(e){e.target.composing||t.$set(t.form,"dosage",e.target.value)}}}),t._v(" "),t.form.hasError("dosage")?e("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.getError("dosage"))}}):t._e()])]),t._v(" "),e("div",{staticClass:"col-lg-4"},[e("div",{staticClass:"mb-4"},[e("label",{staticClass:"form-label",attrs:{for:""}},[t._v("Frequency")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.frequency,expression:"form.frequency"}],staticClass:"form-control",attrs:{type:"number"},domProps:{value:t.form.frequency},on:{input:function(e){e.target.composing||t.$set(t.form,"frequency",e.target.value)}}}),t._v(" "),t.form.hasError("frequency")?e("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.getError("frequency"))}}):t._e()])]),t._v(" "),e("div",{staticClass:"col-lg-4"},[e("div",{staticClass:"form-group"},[e("label",{staticClass:"form-label",attrs:{for:""}},[t._v("Duration "),e("small",{staticClass:"text-indigo"},[t._v("(days)")])]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.duration,expression:"form.duration"}],staticClass:"form-control",attrs:{type:"number",min:"1"},domProps:{value:t.form.duration},on:{input:function(e){e.target.composing||t.$set(t.form,"duration",e.target.value)}}}),t._v(" "),t.form.hasError("duration")?e("span",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.getError("duration"))}}):t._e()])])])]),t._v(" "),e("b-modal",{attrs:{id:"prescription-update-modal",title:"Prescription Form","title-class":"font-18","no-close-on-backdrop":"",scrollable:"","footer-bg-variant":"light","hide-header-close":"",size:"lg"},scopedSlots:t._u([{key:"modal-footer",fn:function(s){var a=s.cancel;return[e("div",{staticClass:"d-flex justify-content-between align-items-center bg-light-alpha"},[e("button",{staticClass:"btn btn-light mr-2",attrs:{disabled:t.form.processing},on:{click:a}},[t._v("\n          Close\n        ")]),t._v(" "),e("button",{staticClass:"btn btn-success",attrs:{form:"prescriptionUpdateForm",type:"submit",disabled:t.form.processing}},[t._v("\n          "+t._s(t.form.processing?"Processing...":"Update")+"\n        ")])])]}}])},[e("form",{attrs:{id:"prescriptionUpdateForm"},on:{submit:function(e){return e.preventDefault(),t.updatePrescription.apply(null,arguments)}}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-8"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"provisional_diagnosis"}},[t._v("Medicine")]),t._v(" "),e("v-select",{attrs:{options:t.items,label:"name",reduce:function(t){return t.id},clearable:!1,name:"item_id"},model:{value:t.form.item_id,callback:function(e){t.$set(t.form,"item_id",e)},expression:"form.item_id"}}),t._v(" "),t.form.errors.has("item_id")?e("div",{staticClass:"text-danger",domProps:{textContent:t._s(t.form.errors.first("item_id"))}}):t._e(),t._v(" "),t.form.item_id?e("span",{staticClass:"small text-purple"},[t._v("Available stock: "+t._s(t.availableStock))]):t._e()],1)]),t._v(" "),e("div",{staticClass:"col-md-4"},[e("div",{staticClass:"form-group"},[e("div",{},[e("label",{class:{"border-danger":t.form.errors.has("dosage")},attrs:{for:"dosage"}},[t._v("Dosage\n              ")])]),t._v(" "),e("b-form-input",{attrs:{id:"dosage",type:"number",min:"1"},model:{value:t.form.dosage,callback:function(e){t.$set(t.form,"dosage",e)},expression:"form.dosage"}}),t._v(" "),t.form.errors.has("dosage")?e("small",{staticClass:"text-danger"},[t._v("\n              "+t._s(t.form.errors.first("dosage"))+"\n            ")]):t._e()],1)])]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-4"},[e("div",{staticClass:"form-group"},[e("div",{staticClass:"d-flex justify-content-between align-items-baseline"},[e("label",{class:{"border-danger":t.form.errors.has("frequency")},attrs:{for:"dosage"}},[t._v("Frequency\n                "),e("i",{staticClass:"uil uil-question-circle text-muted small",attrs:{id:"frequency_helpTex"}})]),t._v(" "),e("b-tooltip",{attrs:{target:"frequency_helpTex",variant:"secondary"}},[t._v("\n                How frequent should the drug be taken?\n              ")]),t._v(" "),e("small",{staticClass:"text-muted"},[t._v("\n                "+t._s(t.form.frequency)+" times")])],1),t._v(" "),e("b-form-input",{attrs:{id:"dosage",type:"number",min:"1",max:"20"},model:{value:t.form.frequency,callback:function(e){t.$set(t.form,"frequency",e)},expression:"form.frequency"}}),t._v(" "),t.form.errors.has("frequency")?e("small",{staticClass:"text-danger"},[t._v("\n              "+t._s(t.form.errors.first("frequency"))+"\n            ")]):t._e()],1)]),t._v(" "),e("div",{staticClass:"col-md-4"},[e("div",{staticClass:"form-group"},[e("div",{staticClass:"d-flex justify-content-between align-items-baseline"},[e("label",{class:{"border-danger":t.form.errors.has("duration")},attrs:{for:"duration"}},[t._v("\n                Duration\n                "),e("i",{staticClass:"uil uil-question-circle text-muted small",attrs:{id:"duration_helpTex"}})]),t._v(" "),e("b-tooltip",{attrs:{target:"duration_helpTex",variant:"secondary"}},[t._v("\n                How long (in days) should the medicine be taken?\n              ")]),t._v(" "),e("small",{staticClass:"text-muted"},[t._v("\n                "+t._s(t.form.duration)+" day(s)")])],1),t._v(" "),e("b-form-input",{attrs:{id:"dosage",type:"number",min:"1",max:"20"},model:{value:t.form.duration,callback:function(e){t.$set(t.form,"duration",e)},expression:"form.duration"}}),t._v(" "),t.form.errors.has("duration")?e("small",{staticClass:"text-danger"},[t._v("\n              "+t._s(t.form.errors.first("duration"))+"\n            ")]):t._e()],1)]),t._v(" "),e("div",{staticClass:"col-md-4"},[e("div",{staticClass:"form-group"},[e("label",{class:{"border-danger":t.form.errors.has("intake_id")},attrs:{for:"intake_id"}},[t._v("\n              Intake\n              "),e("i",{staticClass:"uil uil-question-circle text-muted small",attrs:{id:"intake_id_helpTex"}}),t._v(" "),e("b-tooltip",{attrs:{target:"intake_id_helpTex",variant:"secondary"}},[t._v("\n                On what condition should the prescription be taken?\n              ")])],1),t._v(" "),e("v-select",{attrs:{id:"intake_id",options:t.intakes,label:"name",reduce:function(t){return t.id},clearable:!1},model:{value:t.form.intake_id,callback:function(e){t.$set(t.form,"intake_id",e)},expression:"form.intake_id"}}),t._v(" "),t.form.errors.has("intake_id")?e("small",{staticClass:"text-danger"},[t._v("\n              "+t._s(t.form.errors.first("intake_id"))+"\n            ")]):t._e()],1)])]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"comments"}},[t._v("Remarks")]),t._v(" "),e("b-form-textarea",{staticClass:"shadow-sm",attrs:{id:"comments"},model:{value:t.form.comments,callback:function(e){t.$set(t.form,"comments",e)},expression:"form.comments"}}),t._v(" "),t.form.errors.has("comments")?e("span",{staticClass:"text-danger"},[t._v("\n          "+t._s(t.form.errors.first("comments"))+"\n        ")]):t._e()],1)])])],1)}),[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",{staticClass:"ps-2"},[t._v("\n            Date\n          ")]),t._v(" "),e("th",{staticClass:"ps-2"},[t._v("\n            Drug\n          ")]),t._v(" "),e("th",{staticClass:"ps-2"},[t._v("\n            Dosage\n          ")]),t._v(" "),e("th",{staticClass:"ps-2"},[t._v("\n            Frequency\n          ")]),t._v(" "),e("th",{staticClass:"ps-2"},[t._v("\n            Duration (days)\n          ")]),t._v(" "),e("th",{staticClass:"ps-2"},[t._v("\n            Written By\n          ")]),t._v(" "),e("th",{staticClass:"ps-2"},[t._v("\n            Price\n          ")])])])}],!1,null,null,null).exports}}]);